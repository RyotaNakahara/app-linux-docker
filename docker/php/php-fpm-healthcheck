#!/bin/sh

# Simple PHP-FPM healthcheck script
# Checks if PHP-FPM is responding

set -e

# Check if PHP-FPM is listening
if ! nc -z 127.0.0.1 9000 2>/dev/null; then
    echo "PHP-FPM is not listening on port 9000"
    exit 1
fi

# Try to access the ping endpoint
response=$(SCRIPT_NAME=/ping SCRIPT_FILENAME=/ping REQUEST_METHOD=GET cgi-fcgi -bind -connect 127.0.0.1:9000 2>/dev/null || true)

if echo "$response" | grep -q "pong"; then
    echo "PHP-FPM is healthy"
    exit 0
else
    echo "PHP-FPM ping failed"
    exit 1
fi


